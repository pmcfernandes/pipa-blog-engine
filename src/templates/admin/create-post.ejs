<%- include('./partials/header') %>

    <script type="text/javascript">
      document.addEventListener('alpine:init', () => {
          Alpine.data('createPostForm', () => ({
              title: '',
              content: '',
              status: 'published',
              tags: '',
              errorMessage: '<%= errorMessage %>',

              init() {
              },

              initQuill() {
                  this.quill = new Quill(this.$refs.quillEditor, { theme: 'snow' });
                  this.quill.on('text-change', () => {
                    this.content = this.quill.root.innerHTML;
                  });
              },

              submitForm($ev) {
                  if (this.title === '' || this.content === '') {
                      this.errorMessage = 'Title and Content are required.';
                      return;
                  }

                  fetch($ev.target.getAttribute('action'), {
                      method: $ev.target.getAttribute('method'),
                      headers: {
                          'Content-Type': 'application/json',
                          'Authorization': 'Bearer ' + getCookie('admin_jwt_token')
                      },
                      body: JSON.stringify({
                          title: this.title,
                          content: this.content,
                          published: this.status === 'published',
                          tags: this.tags || ''
                      })
                    }).then(response => response.json()).then(data => {
                      window.location.href = '/admin/dashboard';
                    }).catch(error => {
                      this.errorMessage = 'An error occurred. Please try again later.';
                    });
              },

              backToDashboard() {
                  window.location.href = '/admin/dashboard';
              }

          }))
      });
    </script>

    <div class="admin-create-post-page" x-data="createPostForm" x-init="init()" >

      <button x-on:click="backToDashboard" class="back-to-dashboard-button">
        <i class="lni lni-arrow-left"></i> Back to Dashboard
      </button>

      <h2>Create New Blog Post</h2>

      <form action="/api/blogs/<%= blogId %>/posts" method="POST" @submit.prevent="submitForm">
          <div class="admin-error-message" x-show="errorMessage" x-text="errorMessage">
            <%= errorMessage %>
          </div>

          <div>
              <label for="title">Title:</label>
              <input type="text" id="title" name="title" x-model="title" />
          </div>
          <div>
              <label for="content">Content:</label>
              <textarea id="content" name="content" x-model="content" hidden></textarea>
              <div id="editor" x-ref="quillEditor" x-init="initQuill()"></div>
          </div>
          <div>
              <button type="submit">Create Post</button>
          </div>
      </form>

    </div>

<%- include('./partials/footer') %>
